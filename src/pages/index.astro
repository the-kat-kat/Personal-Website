---
import Layout from "../layouts/Layout.astro";
import { games } from "../data/games.js";

// Welcome to Astro! Wondering what to do next? Check out the Astro documentation at https://docs.astro.build
// Don't want to use any of this? Delete everything in this file, the `assets`, `components`, and `layouts` directories, and start fresh.
---

<Layout title="Kat's Korner" />

<!-- Projects -->
<div class="mb-16 w-full">
  <h1 class="text-3xl justify-self-center mb-4">Games</h1>
  <div
    class="grid grid-cols-1 md:grid-cols-2 justify-center items-center gap-9 max-w-5xl mx-auto"
  >
    {
      games.map((game) => (
        <a href={`/games/${game.slug}`} class="group block">
          <div class="bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl overflow-hidden transition-all hover:scale-[1.06] hover:bg-white/10 shadow-xl">
            <img
              src={game.previewImage}
              alt={game.title}
              class="w-full aspect-video object-cover"
            />

            <div class="p-6">
              <h2 class="text-2xl text-light-ocean group-hover:text-white">
                {game.title}
              </h2>
              <p class="text-white mt-2">{game.description}</p>
            </div>
          </div>
        </a>
      ))
    }
  </div>
</div>

<!--On Top -->
<div
  id="whale"
  class="fixed top-10 left-10 z-100 pointer-events-none flex flex-col items-start"
>
  <img
    id="heart-button"
    src="/assets/whale-1.png"
    alt="hamster with a heart"
    class="w-1/3 cusor-pointer pointer-events-auto mb-4 hover:scale-[1.1] transition-transform"
  />
  <audio id="heart-music" src="/assets/turn-it-up.mp3"></audio>

  <div
    id="now-playing"
    class="opacity-0 transition-opacity duration-1000 mb-2 w-1/3 justify-center items-center"
  >
    <div
      class="flex items-center place-self-center justify-center self-justify-center w-1/2 text-white px-4 py-1 rounded-full text-sm text-center"
    >
      Click Me
    </div>
  </div>
</div>

<script>
  //whale scroll
  const whale=document.getElementById("whale");

  window.addEventListener("scroll", () =>{
    const scrolled=window.scrollY;

    const scrollSpeed=scrolled*0.2;

    if(whale){
      whale.style.transform = `translateY(${scrollSpeed}px)`
    }
  });

  //music
  const playlist = [
    {
      title: "Spring Waltz - The Tale of the Princess Kaguya",
      file: "/assets/music/SpringWaltz.mp3",
    },
    {
      title: "The Girls Who Fell from the Sky - Castle in the Sky",
      file: "/assets/music/FellSky.mp3",
    },
    {
      title: "The Flower Garden - Howl's Moving Castle",
      file: "/assets/music/TheFlowerGarden.mp3",
    },
  ];

  const heartButton = document.getElementById("heart-button");
  const music = document.getElementById("heart-music") as HTMLAudioElement;
  const nowBox = document.getElementById("now-playing");
  let index = -1;

  let isPlaying = false;

  if (heartButton && music && nowBox) {
    heartButton.addEventListener("click", () => {
      index += 1;
      if (index >= playlist.length) {
        index = 0;
      }
      const randomTrack = playlist[index];

      music.src = randomTrack.file;
      music.play();

      (heartButton as HTMLImageElement).src = "/assets/whale-2.png";
      nowBox.innerText = `Now Playing: ${randomTrack.title}`;
      isPlaying = true;
      nowBox.classList.remove("opacity-0");
      nowBox.classList.add("opacity-100");
    });

    heartButton.addEventListener("mouseenter", () => {
      (heartButton as HTMLImageElement).src = "/assets/whale-2.png";
      nowBox.classList.remove("opacity-0");
      nowBox.classList.add("opacity-100");
    });

    heartButton.addEventListener("mouseleave", () => {
      (heartButton as HTMLImageElement).src = "/assets/whale-1.png";
      nowBox.classList.remove("opacity-100");
      nowBox.classList.add("opacity-0");
    });
  }
</script>
